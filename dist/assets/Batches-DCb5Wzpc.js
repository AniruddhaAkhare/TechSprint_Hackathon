import{u as G,f as J,r as a,y as n,j as t,L as K,d as Q,b as d,g as X,c as l,e as h,q as Y,w as _}from"./index-D_3nfyX1.js";const V=()=>{const{studentId:u}=G(),{user:i}=J(),[y,b]=a.useState([]),[S,v]=a.useState([]),[A,B]=a.useState([]),[N,C]=a.useState([]),[k,F]=a.useState([]),[w,L]=a.useState({}),[g,U]=a.useState(null),[E,p]=a.useState(!0),[f,$]=a.useState();a.useEffect(()=>{(async()=>{if(i)try{const r=Q(d,"Users",i.uid),s=await X(r);if(s.exists()){const c=s.data(),x="RDJ9wMXGrIUk221MzDxP";x&&$(x)}else n.error("User data not found",{toastId:"user-error"})}catch(r){n.error(`Failed to fetch data: ${r.message}`,{toastId:"data-error"})}})()},[i]),a.useEffect(()=>{if(!i){n.error("Please log in to view batches",{toastId:"auth-error"}),p(!1);return}if(!u){n.error("Invalid student ID",{toastId:"student-id-error"}),p(!1);return}(async()=>{p(!0);try{if(!f)throw new Error("No institute ID found for the user");await Promise.all([M(f),P(f),R(),T(),q()])}catch(r){n.error(`Failed to load data: ${r.message}`,{toastId:"data-error"})}finally{p(!1)}})()},[u,i,f]);const M=async e=>{try{const c=(await l(h(d,"Batch"))).docs.map(o=>({id:o.id,...o.data()})).filter(o=>o.students&&o.students.includes(u));b(c);const x={};for(const o of c){const O=Y(h(d,`Batch/${o.id}/assessments`),_("studentId","==",u)),z=await l(O);x[o.id]=z.docs.map(I=>({id:I.id,...I.data()}))}L(x)}catch(r){n.error(`Failed to fetch batches or assessments: ${r.message}`,{toastId:"batches-error"})}},P=async e=>{try{const s=(await l(h(d,`instituteSetup/${e}/Center`))).docs.map(c=>({id:c.id,...c.data()}));v(s)}catch{n.error("Failed to fetch centers",{toastId:"centers-error"})}},R=async()=>{try{const r=(await l(h(d,"Course"))).docs.map(s=>({id:s.id,...s.data()}));B(r)}catch{n.error("Failed to fetch courses",{toastId:"courses-error"})}},T=async()=>{try{const r=(await l(h(d,"Users"))).docs.map(s=>({id:s.id,...s.data()}));C(r)}catch{n.error("Failed to fetch instructors",{toastId:"instructors-error"})}},q=async()=>{try{const r=(await l(h(d,"curriculums"))).docs.map(s=>({id:s.id,...s.data()}));F(r)}catch{n.error("Failed to fetch curriculum",{toastId:"curriculum-error"})}},m=(e,r)=>{if(!e||!r)return"Unknown";const s=r.find(c=>c.id===e);return s&&(s.name||s.f_name||s.firstName)||"Unknown"},j=e=>{if(!e)return"N/A";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(r){return console.warn("Error formatting date:",r),"Invalid Date"}},D=e=>{U(g===e?null:e)};return i?E?t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-gray-600",children:"Loading batches..."})}):t.jsxs("div",{className:"p-4",children:[t.jsx(K,{position:"top-right",autoClose:3e3,limit:3}),y.length===0?t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:t.jsxs("p",{className:"text-gray-600",children:["You are not enrolled in any batches. (Student ID: ",u,")"]})}):t.jsx("div",{className:"bg-white rounded-lg shadow-md",children:t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-100",children:[t.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Batch Name"}),t.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Start Date"}),t.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"End Date"}),t.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Status"})]})}),t.jsx("tbody",{children:y.map(e=>{var r;return t.jsxs(a.Fragment,{children:[t.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer hover:text-blue-500 transition-colors duration-200",onClick:()=>D(e.id),onKeyDown:s=>s.key==="Enter"&&D(e.id),role:"button",tabIndex:0,"aria-expanded":g===e.id,"aria-controls":`accordion-${e.id}`,"aria-label":`Toggle details for ${e.batchName||"Unnamed Batch"}`,children:[t.jsx("td",{className:"p-3 text-gray-700",children:e.batchName||"Unnamed Batch"}),t.jsx("td",{className:"p-3 text-gray-700",children:j(e.startDate)}),t.jsx("td",{className:"p-3 text-gray-700",children:j(e.endDate)}),t.jsx("td",{className:"p-3 text-gray-700",children:e.status||"Unknown"})]}),g===e.id&&t.jsx("tr",{id:`accordion-${e.id}`,children:t.jsx("td",{colSpan:"4",className:"p-4 bg-gray-50",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-700",children:"Batch Information"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Centers:"})," ",(e.centers||[]).map(s=>m(s,S)).join(", ")||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Courses:"})," ",(e.courses||[]).map(s=>m(s,A)).join(", ")||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Curriculum:"})," ",(e.curriculum||[]).map(s=>m(s,k)).join(", ")||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Batch Manager:"})," ",(e.batchManager||[]).map(s=>m(s,N)).join(", ")||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Batch Faculty:"})," ",(e.batchFaculty||[]).map(s=>m(s,N)).join(", ")||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Created At:"})," ",j(e.createdAt)]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Assessments"}),((r=w[e.id])==null?void 0:r.length)>0?t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-200",children:[t.jsx("th",{className:"p-2 text-sm font-medium text-gray-600 text-left",children:"Marks Obtained"}),t.jsx("th",{className:"p-2 text-sm font-medium text-gray-600 text-left",children:"Total Marks"}),t.jsx("th",{className:"p-2 text-sm font-medium text-gray-600 text-left",children:"Date"}),t.jsx("th",{className:"p-2 text-sm font-medium text-gray-600 text-left",children:"Type"})]})}),t.jsx("tbody",{children:(w[e.id]||[]).map(s=>t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"p-2 text-gray-700",children:t.jsx("span",{children:s.marksObtained??"N/A"})}),t.jsx("td",{className:"p-2 text-gray-700",children:t.jsx("span",{children:s.totalMarks??"N/A"})}),t.jsx("td",{className:"p-2 text-gray-700",children:t.jsx("span",{children:j(s.date)})}),t.jsx("td",{className:"p-2 text-gray-700",children:t.jsx("span",{children:s.type||"N/A"})})]},s.id))})]}):t.jsx("p",{className:"text-gray-600",children:"No assessments available for this batch."})]})]})})})]},e.id)})})]})})]}):t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-red-600",children:"Please log in to view your batches."})})};export{V as default};
//# sourceMappingURL=Batches-DCb5Wzpc.js.map
