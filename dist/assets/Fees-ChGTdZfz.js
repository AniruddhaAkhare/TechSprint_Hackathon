import{r as u,j as e,g as j,d as D,b}from"./index-D_3nfyX1.js";const Le=({studentId:p})=>{var S,T,R,C,k,L,E,$,B,M,O,I,V,z,q,G,H,J,K,Q,U,W,X,Y,Z,_,ee,te,ae,se,le,ne,ie,re,ce,de,me,xe,oe,he,fe,ge,ue,pe,Ne,ye,je,De,be,ve,Fe,Ae;const[t,v]=u.useState(null),[we,Pe]=u.useState([]),[Se,F]=u.useState(!0),[A,N]=u.useState(null),[w,Te]=u.useState(null),Re=a=>{var x,o,h,n,i;let l=0,c=0;const m=new Date;if(a.feeTemplate==="Installments"&&a.installmentDetails)a.installmentDetails.forEach(s=>{const d=new Date(s.dueDate),r=parseFloat(s.dueAmount)||0,f=parseFloat(s.paidAmount)||0;s.status!=="Paid"&&(d<m?c+=r-f:l+=r-f)});else if(a.feeTemplate==="FullFees"&&a.fullFeesDetails){const s=parseFloat((x=a.fullFeesDetails.registration)==null?void 0:x.amount)||0,d=parseFloat((o=a.fullFeesDetails.finalPayment)==null?void 0:o.amount)||0,r=s+d,g=(parseFloat(a.fullFeesDetails.feeAfterDiscount)||0)-r;g>0&&(((h=a.fullFeesDetails.registration)!=null&&h.date?new Date(a.fullFeesDetails.registration.date):m)<m&&((n=a.fullFeesDetails.registration)==null?void 0:n.status)!=="Paid"?c=g:l=g)}else if(a.feeTemplate==="Finance"&&a.financeDetails){const s=parseFloat(a.financeDetails.loanAmount)||0,d=parseFloat(a.financeDetails.downPayment)||0,r=parseFloat((i=a.financeDetails.registration)==null?void 0:i.amount)||0,f=s-(d+r);(a.financeDetails.loanStatus==="Pending"||a.financeDetails.loanStatus==="Approved")&&(l=f)}return{outstanding:l,overdue:c}};if(u.useEffect(()=>{(async()=>{F(!0),N(null);try{const l=await j(D(b,"student",p));if(l.exists())Te(l.data());else throw new Error("No such student found!");const c=await j(D(b,"enrollments",p));if(c.exists()&&c.data().courses){const m=c.data().courses,x=m.map(n=>{var i;return(i=n.selectedCourse)!=null&&i.id?j(D(b,"Course",n.selectedCourse.id)):Promise.resolve(null)}),o=await Promise.all(x),h=m.map((n,i)=>{var g,y;const s=o[i],d=s&&s.exists()?s.data().name:((g=n.selectedCourse)==null?void 0:g.name)||"Course not found",{outstanding:r,overdue:f}=Re(n);return{...n,id:((y=n.selectedCourse)==null?void 0:y.id)||`course-${i}`,name:d,totalOutstanding:r,totalOverdue:f}});Pe(h)}else N("No enrollments found for this student.")}catch(l){N(l.message||"Failed to fetch data.")}finally{F(!1)}})()},[p]),Se)return e.jsx("p",{className:"text-gray-600 text-center py-10",children:"Loading..."});if(A)return e.jsx("p",{className:"text-red-500 text-center py-10",children:A});const Ce=a=>v(a),P=()=>v(null);return e.jsxs("div",{className:"",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Sr."}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Course"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Mode"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Fee Template"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Total Fees (₹)"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Discount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Fee After Discount (₹)"})]})}),e.jsx("tbody",{children:we.map((a,l)=>{var c,m,x,o,h,n,i,s,d,r;return e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>Ce(a),children:[e.jsx("td",{className:"p-3 text-gray-700",children:l+1}),e.jsx("td",{className:"p-3 text-gray-700",children:a.name}),e.jsx("td",{className:"p-3 text-gray-700",children:a.mode||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:a.feeTemplate||"N/A"}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((c=a.fullFeesDetails)==null?void 0:c.totalFees)||((m=a.financeDetails)==null?void 0:m.loanAmount)||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:(x=a.fullFeesDetails)!=null&&x.discountType||(o=a.financeDetails)!=null&&o.discountType?`${((h=a.fullFeesDetails)==null?void 0:h.discountValue)||((n=a.financeDetails)==null?void 0:n.discountValue)}${((i=a.fullFeesDetails)==null?void 0:i.discountType)==="percentage"||((s=a.financeDetails)==null?void 0:s.discountType)==="percentage"?"%":"₹"}`:"0"}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((d=a.fullFeesDetails)==null?void 0:d.feeAfterDiscount)||((r=a.financeDetails)==null?void 0:r.feeAfterDiscount)||0]})]},a.id)})})]})})}),t&&w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:P}),e.jsxs("div",{className:"fixed right-0 top-0 w-2/4 h-full bg-white shadow-lg p-6 z-50 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:`${w.Name}`}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Course: ",t.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mode: ",t.mode||"Not specified"]}),e.jsx("div",{className:"mt-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Total Fees"}),e.jsx("input",{type:"text",value:`₹${((S=t.fullFeesDetails)==null?void 0:S.totalFees)||((T=t.financeDetails)==null?void 0:T.loanAmount)||0}`,readOnly:!0,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-700 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Fee After Discount"}),e.jsx("input",{type:"text",value:`₹${((R=t.fullFeesDetails)==null?void 0:R.feeAfterDiscount)||((C=t.financeDetails)==null?void 0:C.feeAfterDiscount)||0}`,readOnly:!0,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-700 focus:outline-none"})]})]})}),t.registration&&t.feeTemplate==="Installments"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Registration Payment"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Received By"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Payment Method"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Remark"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Status"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((k=t.registration)==null?void 0:k.amount)||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:(L=t.registration)!=null&&L.date?new Date(t.registration.date).toLocaleDateString():"Not paid"}),e.jsx("td",{className:"p-3 text-gray-700",children:((E=t.registration)==null?void 0:E.receivedBy)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:(($=t.registration)==null?void 0:$.paymentMethod)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((B=t.registration)==null?void 0:B.remark)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((M=t.registration)==null?void 0:M.status)||"Pending"})]})})]})})]}),t.feeTemplate==="FullFees"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Payment Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Type"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Received By"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Remark"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Status"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-700",children:"Registration"}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((I=(O=t.fullFeesDetails)==null?void 0:O.registration)==null?void 0:I.amount)||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:(z=(V=t.fullFeesDetails)==null?void 0:V.registration)!=null&&z.date?new Date(t.fullFeesDetails.registration.date).toLocaleDateString():"Not paid"}),e.jsx("td",{className:"p-3 text-gray-700",children:((G=(q=t.fullFeesDetails)==null?void 0:q.registration)==null?void 0:G.receivedBy)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((J=(H=t.fullFeesDetails)==null?void 0:H.registration)==null?void 0:J.remark)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((Q=(K=t.fullFeesDetails)==null?void 0:K.registration)==null?void 0:Q.status)||"Pending"})]}),e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-700",children:"Final Payment"}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((W=(U=t.fullFeesDetails)==null?void 0:U.finalPayment)==null?void 0:W.amount)||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:(Y=(X=t.fullFeesDetails)==null?void 0:X.finalPayment)!=null&&Y.date?new Date(t.fullFeesDetails.finalPayment.date).toLocaleDateString():"Not paid"}),e.jsx("td",{className:"p-3 text-gray-700",children:((_=(Z=t.fullFeesDetails)==null?void 0:Z.finalPayment)==null?void 0:_.receivedBy)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((te=(ee=t.fullFeesDetails)==null?void 0:ee.finalPayment)==null?void 0:te.remark)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((se=(ae=t.fullFeesDetails)==null?void 0:ae.finalPayment)==null?void 0:se.status)||"Pending"})]})]})]})})]}),t.feeTemplate==="Installments"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Installments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"No."}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Due Amount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Due Date"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Paid Amount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Paid Date"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Status"})]})}),e.jsx("tbody",{children:(le=t.installmentDetails)==null?void 0:le.map((a,l)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-700",children:a.number||l+1}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",a.dueAmount||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:a.dueDate?new Date(a.dueDate).toLocaleDateString():"N/A"}),e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",a.paidAmount||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:a.paidDate?new Date(a.paidDate).toLocaleDateString():"Not paid"}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:a.status==="Paid"?"text-green-500":a.status==="Overdue"||!a.paidDate&&new Date(a.dueDate)<new Date?"text-red-500":"text-yellow-500",children:a.status||(a.paidDate?"Paid":new Date(a.dueDate)<new Date?"Overdue":"Pending")})})]},l))})]})})]}),t.feeTemplate==="Free"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-gray-600",children:"This is a free course. No payment required."}),t.freeReason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",t.freeReason]})]}),t.feeTemplate==="Finance"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Finance Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Finance Partner:"})," ",((ne=t.financeDetails)==null?void 0:ne.financePartner)||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contact Person:"})," ",((ie=t.financeDetails)==null?void 0:ie.contactPerson)||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Scheme:"})," ",((re=t.financeDetails)==null?void 0:re.scheme)||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Loan Amount:"})," ₹",((ce=t.financeDetails)==null?void 0:ce.loanAmount)||0]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Down Payment:"})," ₹",((de=t.financeDetails)==null?void 0:de.downPayment)||0]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Down Payment Date:"})," ",(me=t.financeDetails)!=null&&me.downPaymentDate?new Date(t.financeDetails.downPaymentDate).toLocaleDateString():"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Applicant Name:"})," ",((xe=t.financeDetails)==null?void 0:xe.applicantName)||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Relationship:"})," ",((oe=t.financeDetails)==null?void 0:oe.relationship)||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Loan Status:"}),e.jsx("span",{className:((he=t.financeDetails)==null?void 0:he.loanStatus)==="Pending"?"text-yellow-500":((fe=t.financeDetails)==null?void 0:fe.loanStatus)==="Approved"?"text-blue-500":((ge=t.financeDetails)==null?void 0:ge.loanStatus)==="Active"?"text-green-500":"text-gray-500",children:((ue=t.financeDetails)==null?void 0:ue.loanStatus)||"N/A"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Discount:"})," ",(pe=t.financeDetails)!=null&&pe.discountType?`${t.financeDetails.discountValue}${t.financeDetails.discountType==="percentage"?"%":"₹"}`:"None"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Discount Reason:"})," ",((Ne=t.financeDetails)==null?void 0:Ne.discountReason)||"N/A"]})]}),((ye=t.financeDetails)==null?void 0:ye.registration)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Finance Registration Payment"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Received By"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Payment Method"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Remark"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left",children:"Status"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3 text-gray-700",children:["₹",((je=t.financeDetails.registration)==null?void 0:je.amount)||0]}),e.jsx("td",{className:"p-3 text-gray-700",children:(De=t.financeDetails.registration)!=null&&De.date?new Date(t.financeDetails.registration.date).toLocaleDateString():"Not paid"}),e.jsx("td",{className:"p-3 text-gray-700",children:((be=t.financeDetails.registration)==null?void 0:be.receivedBy)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((ve=t.financeDetails.registration)==null?void 0:ve.paymentMethod)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((Fe=t.financeDetails.registration)==null?void 0:Fe.remark)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-700",children:((Ae=t.financeDetails.registration)==null?void 0:Ae.status)||"Pending"})]})})]})})]})]}),e.jsx("button",{onClick:P,className:"mt-6 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200",children:"Close"})]})]})]})};export{Le as default};
//# sourceMappingURL=Fees-ChGTdZfz.js.map
