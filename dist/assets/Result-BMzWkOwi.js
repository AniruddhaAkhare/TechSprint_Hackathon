import{u as O,r as u,j as s,L as U,g as C,d as j,b as x,c as v,e as D,s as _,y as M}from"./index-Bc4qYO8_.js";const z=()=>{const{studentId:l}=O(),[f,R]=u.useState([]),[S,L]=u.useState([]),[d,y]=u.useState({}),[E,N]=u.useState(!0),[b,h]=u.useState(null);u.useEffect(()=>{(async()=>{N(!0),h(null);try{const t=await C(j(x,"enrollments",l));if(t.exists()&&t.data().courses){const a=t.data().courses,o=a.map(g=>{var m;return C(j(x,"Course",((m=g.selectedCourse)==null?void 0:m.id)||""))}),$=await Promise.all(o),F=a.map((g,m)=>{var w;const k=$[m],T=k.exists()?k.data().name:"Course not found";return{...g,id:((w=g.selectedCourse)==null?void 0:w.id)||`course-${m}`,name:T}});R(F)}else h("No enrollments found for this student.");const r=await v(D(x,"Course"));L(r.docs.map(a=>({id:a.id,...a.data()})));const c=(await v(D(x,"Result"))).docs.map(a=>a.data()).reduce((a,o)=>(o.studentId===l&&(a[o.enrollmentId]={status:o.status||"ongoing",marks:o.marks||"",totalMarks:o.totalMarks||""}),a),{});y(c)}catch(t){h(t.message||"Failed to fetch data.")}finally{N(!1)}})()},[l]);const A=e=>{const t=S.find(r=>r.id===e);return t?t.name:"Unknown Course"},p=(e,t,r)=>{y(n=>({...n,[e]:{...n[e]||{status:"ongoing",marks:"",totalMarks:""},[t]:r}}))},P=async e=>{var r,n,i,c;const t=d[e]||{status:"ongoing",marks:"",totalMarks:""};try{const a=j(x,"Result",`${l}_${e}`);await _(a,{studentId:l,enrollmentId:e,courseId:(n=(r=f.find(o=>o.id===e))==null?void 0:r.selectedCourse)==null?void 0:n.id,courseName:A((c=(i=f.find(o=>o.id===e))==null?void 0:i.selectedCourse)==null?void 0:c.id),status:t.status,marks:t.status==="certified"?t.marks:"",totalMarks:t.status==="certified"?t.totalMarks:"",updatedAt:new Date},{merge:!0}),M.success("Result saved successfully!")}catch{M.error("Failed to save result")}};return E?s.jsx("p",{className:"text-gray-600 text-center py-10",children:"Loading..."}):b?s.jsx("p",{className:"text-red-500 text-center py-10",children:b}):s.jsxs("div",{className:"p-4",children:[s.jsx(U,{position:"top-right",autoClose:3e3}),s.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left min-w-[200px]",children:"Course Name"}),s.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left min-w-[150px]",children:"Status"}),s.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left min-w-[120px]",children:"Marks"}),s.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left min-w-[120px]",children:"Total Marks"}),s.jsx("th",{className:"p-3 text-sm font-medium text-gray-600 text-left min-w-[100px]",children:"Actions"})]})}),s.jsx("tbody",{children:f.map(e=>{var t,r,n,i,c;return s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3 text-gray-700",children:e.name}),s.jsx("td",{className:"p-3",children:s.jsxs("select",{value:((t=d[e.id])==null?void 0:t.status)||"ongoing",onChange:a=>p(e.id,"status",a.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"ongoing",children:"Ongoing"}),s.jsx("option",{value:"deferred",children:"Deferred"}),s.jsx("option",{value:"certified",children:"Certified"})]})}),s.jsx("td",{className:"p-3",children:((r=d[e.id])==null?void 0:r.status)==="certified"?s.jsx("input",{type:"number",value:((n=d[e.id])==null?void 0:n.marks)||"",onChange:a=>p(e.id,"marks",a.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Marks"}):s.jsx("span",{className:"text-gray-500",children:"N/A"})}),s.jsx("td",{className:"p-3",children:((i=d[e.id])==null?void 0:i.status)==="certified"?s.jsx("input",{type:"number",value:((c=d[e.id])==null?void 0:c.totalMarks)||"",onChange:a=>p(e.id,"totalMarks",a.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Total Marks"}):s.jsx("span",{className:"text-gray-500",children:"N/A"})}),s.jsx("td",{className:"p-3",children:s.jsx("button",{onClick:()=>P(e.id),className:"bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition duration-200",children:"Save"})})]},e.id)})})]})})]})};export{z as default};
//# sourceMappingURL=Result-BMzWkOwi.js.map
