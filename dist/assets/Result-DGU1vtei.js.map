{"version":3,"file":"Result-DGU1vtei.js","sources":["../../src/StudentInformation/Result.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { getDoc, doc, setDoc, collection, getDocs } from \"firebase/firestore\";\r\nimport { db } from \"../config/firebase\"; // Adjust path as needed\r\nimport { toast, ToastContainer } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\n\r\nconst Result = () => {\r\n    const { studentId } = useParams(); // Get studentId from URL params\r\n    const [enrollmentData, setEnrollmentData] = useState([]);\r\n    const [courses, setCourses] = useState([]);\r\n    const [results, setResults] = useState({});\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setIsLoading(true);\r\n            setError(null);\r\n\r\n            try {\r\n                // Fetch enrollment data\r\n                const enrollmentDoc = await getDoc(doc(db, \"enrollments\", studentId));\r\n                if (enrollmentDoc.exists() && enrollmentDoc.data().courses) {\r\n                    const coursesData = enrollmentDoc.data().courses;\r\n\r\n                    // Fetch course details\r\n                    const coursePromises = coursesData.map(course =>\r\n                        getDoc(doc(db, \"Course\", course.selectedCourse?.id || \"\"))\r\n                    );\r\n                    const courseDocs = await Promise.all(coursePromises);\r\n\r\n                    const formattedEnrollments = coursesData.map((course, index) => {\r\n                        const courseDoc = courseDocs[index];\r\n                        const courseName = courseDoc.exists() ? courseDoc.data().name : \"Course not found\";\r\n                        return {\r\n                            ...course,\r\n                            id: course.selectedCourse?.id || `course-${index}`,\r\n                            name: courseName,\r\n                        };\r\n                    });\r\n\r\n                    setEnrollmentData(formattedEnrollments);\r\n                } else {\r\n                    setError(\"No enrollments found for this student.\");\r\n                }\r\n\r\n                // Fetch course list for reference\r\n                const courseSnapshot = await getDocs(collection(db, \"Course\"));\r\n                setCourses(courseSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n\r\n                // Fetch existing results\r\n                const resultSnapshot = await getDocs(collection(db, \"Result\"));\r\n                const resultList = resultSnapshot.docs.map(doc => doc.data());\r\n                const studentResults = resultList.reduce((acc, result) => {\r\n                    if (result.studentId === studentId) {\r\n                        acc[result.enrollmentId] = {\r\n                            status: result.status || \"ongoing\",\r\n                            marks: result.marks || \"\",\r\n                            totalMarks: result.totalMarks || \"\"\r\n                        };\r\n                    }\r\n                    return acc;\r\n                }, {});\r\n                setResults(studentResults);\r\n            } catch (error) {\r\n                //console.error(\"Error fetching data:\", error);\r\n                setError(error.message || \"Failed to fetch data.\");\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, [studentId]);\r\n\r\n    const getCourseName = (courseId) => {\r\n        const course = courses.find(c => c.id === courseId);\r\n        return course ? course.name : \"Unknown Course\";\r\n    };\r\n\r\n    const handleResultChange = (enrollmentId, field, value) => {\r\n        setResults(prev => ({\r\n            ...prev,\r\n            [enrollmentId]: {\r\n                ...prev[enrollmentId] || { status: \"ongoing\", marks: \"\", totalMarks: \"\" },\r\n                [field]: value\r\n            }\r\n        }));\r\n    };\r\n\r\n    const saveResult = async (enrollmentId) => {\r\n        const resultData = results[enrollmentId] || { status: \"ongoing\", marks: \"\", totalMarks: \"\" };\r\n        try {\r\n            const resultRef = doc(db, \"Result\", `${studentId}_${enrollmentId}`);\r\n            await setDoc(resultRef, {\r\n                studentId,\r\n                enrollmentId,\r\n                courseId: enrollmentData.find(e => e.id === enrollmentId)?.selectedCourse?.id,\r\n                courseName: getCourseName(enrollmentData.find(e => e.id === enrollmentId)?.selectedCourse?.id),\r\n                status: resultData.status,\r\n                marks: resultData.status === \"certified\" ? resultData.marks : \"\",\r\n                totalMarks: resultData.status === \"certified\" ? resultData.totalMarks : \"\",\r\n                updatedAt: new Date()\r\n            }, { merge: true });\r\n            toast.success(\"Result saved successfully!\");\r\n        } catch (error) {\r\n            //console.error(\"Error saving result:\", error);\r\n            toast.error(\"Failed to save result\");\r\n        }\r\n    };\r\n\r\n    if (isLoading) return <p className=\"text-gray-600 text-center py-10\">Loading...</p>;\r\n    if (error) return <p className=\"text-red-500 text-center py-10\">{error}</p>;\r\n\r\n    return (\r\n        <div className=\"p-4\">\r\n            <ToastContainer position=\"top-right\" autoClose={3000} />\r\n            {/* <h2 className=\"text-2xl font-semibold text-gray-800 mb-6\">Student Results</h2> */}\r\n\r\n            <div className=\"bg-white rounded-lg shadow-md overflow-x-auto\">\r\n                <table className=\"w-full border-collapse\">\r\n                    <thead>\r\n                        <tr className=\"bg-gray-100\">\r\n                            <th className=\"p-3 text-sm font-medium text-gray-600 text-left min-w-[200px]\">Course Name</th>\r\n                            <th className=\"p-3 text-sm font-medium text-gray-600 text-left min-w-[150px]\">Status</th>\r\n                            <th className=\"p-3 text-sm font-medium text-gray-600 text-left min-w-[120px]\">Marks</th>\r\n                            <th className=\"p-3 text-sm font-medium text-gray-600 text-left min-w-[120px]\">Total Marks</th>\r\n                            <th className=\"p-3 text-sm font-medium text-gray-600 text-left min-w-[100px]\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {enrollmentData.map(enrollment => (\r\n                            <tr key={enrollment.id} className=\"border-b hover:bg-gray-50\">\r\n                                <td className=\"p-3 text-gray-700\">{enrollment.name}</td>\r\n                                <td className=\"p-3\">\r\n                                    <select\r\n                                        value={results[enrollment.id]?.status || \"ongoing\"}\r\n                                        onChange={(e) => handleResultChange(enrollment.id, \"status\", e.target.value)}\r\n                                        className=\"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"ongoing\">Ongoing</option>\r\n                                        <option value=\"deferred\">Deferred</option>\r\n                                        <option value=\"certified\">Certified</option>\r\n                                    </select>\r\n                                </td>\r\n                                <td className=\"p-3\">\r\n                                    {results[enrollment.id]?.status === \"certified\" ? (\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={results[enrollment.id]?.marks || \"\"}\r\n                                            onChange={(e) => handleResultChange(enrollment.id, \"marks\", e.target.value)}\r\n                                            className=\"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                            placeholder=\"Marks\"\r\n                                        />\r\n                                    ) : (\r\n                                        <span className=\"text-gray-500\">N/A</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"p-3\">\r\n                                    {results[enrollment.id]?.status === \"certified\" ? (\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={results[enrollment.id]?.totalMarks || \"\"}\r\n                                            onChange={(e) => handleResultChange(enrollment.id, \"totalMarks\", e.target.value)}\r\n                                            className=\"w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                            placeholder=\"Total Marks\"\r\n                                        />\r\n                                    ) : (\r\n                                        <span className=\"text-gray-500\">N/A</span>\r\n                                    )}\r\n                                </td>\r\n                                <td className=\"p-3\">\r\n                                    <button\r\n                                        onClick={() => saveResult(enrollment.id)}\r\n                                        className=\"bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition duration-200\"\r\n                                    >\r\n                                        Save\r\n                                    </button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Result;"],"names":["Result","studentId","useParams","enrollmentData","setEnrollmentData","useState","courses","setCourses","results","setResults","isLoading","setIsLoading","error","setError","useEffect","enrollmentDoc","getDoc","doc","db","coursesData","coursePromises","course","_a","courseDocs","formattedEnrollments","index","courseDoc","courseName","courseSnapshot","getDocs","collection","studentResults","acc","result","getCourseName","courseId","c","handleResultChange","enrollmentId","field","value","prev","saveResult","resultData","resultRef","setDoc","_b","e","_d","_c","toast","jsx","jsxs","ToastContainer","enrollment","_e"],"mappings":"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"}